<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arsip Biro Kepesantrenan</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981', 
                        slate: { 850: '#1e293b' }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        .glass-effect {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
        }
        /* Animation Classes */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(2px);
        }
        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 transition-colors duration-300 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- KONFIGURASI BACKEND ---
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxL0Sg97MZTAlNthUUHuHsgvKl8rS3HPl_SheTH_CidffPh-Sr4VRT-B2HKgdFhBcW7/exec";

        // --- ICONS (Lucide React equivalent) ---
        const Icons = {
            LayoutDashboard: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>,
            FolderOpen: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2"/></svg>,
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Search: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Menu: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            Upload: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Edit: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>,
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Eye: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            LogOut: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
            Moon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Building2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>,
            FileCheck: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="m9 15 2 2 4-4"/></svg>,
            ShieldCheck: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            ChevronLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            List: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>,
            Grid: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            Filter: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>,
            LinkIcon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            Globe: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>,
            AlertCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            HelpCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
        };

        // --- GLOBAL COMPONENTS (Defined outside App to avoid ReferenceError) ---

        const SidebarItem = ({ id, icon: IconName, label, activeMenu, setActiveMenu, isSidebarOpen }) => {
            const Icon = Icons[IconName];
            const active = activeMenu === id;
            return (
                <button
                    onClick={() => setActiveMenu(id)}
                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all duration-200 group ${
                        active
                        ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30'
                        : 'text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800'
                    }`}
                >
                    <Icon width={20} className={active ? 'text-white' : 'text-slate-400 group-hover:text-slate-600 dark:group-hover:text-slate-300'} />
                    {isSidebarOpen && <span className="font-medium animate-fade-in">{label}</span>}
                </button>
            );
        };

        const BottomNavItem = ({ id, icon: IconName, label, activeMenu, setActiveMenu }) => {
            const Icon = Icons[IconName];
            const active = activeMenu === id;
            return (
                <button
                    onClick={() => setActiveMenu(id)}
                    className={`flex flex-1 items-center justify-center space-x-2 px-3 py-2 rounded-full transition-all duration-200 ${
                        active
                        ? 'bg-blue-600 text-white shadow-md'
                        : 'text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800'
                    }`}
                >
                    <Icon width={18} className={active ? 'text-white' : ''} />
                    <span className={`text-xs font-semibold whitespace-nowrap ${active ? 'block' : 'block'}`}>{label}</span>
                </button>
            );
        };

        const ConfirmModal = ({ title, message, isDanger, isAlert, onConfirm, onCancel }) => (
            <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
                <div className="bg-white dark:bg-slate-800 w-full max-w-sm rounded-2xl p-6 shadow-2xl animate-slide-up border border-slate-200 dark:border-slate-700">
                    <div className="flex flex-col items-center text-center">
                        <div className={`mb-4 p-3 rounded-full ${isDanger ? 'bg-red-100 text-red-600' : (isAlert ? 'bg-yellow-100 text-yellow-600' : 'bg-blue-100 text-blue-600')}`}>
                            {isDanger ? <Icons.Trash2 width={32} /> : (isAlert ? <Icons.AlertCircle width={32} /> : <Icons.HelpCircle width={32} />)}
                        </div>
                        <h3 className="text-lg font-bold text-slate-800 dark:text-white mb-2">{title}</h3>
                        <p className="text-slate-500 dark:text-slate-400 mb-6 text-sm">{message}</p>
                        <div className="flex gap-3 w-full">
                            {!isAlert && (
                                <button onClick={onCancel} className="flex-1 py-2.5 rounded-xl border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 font-semibold hover:bg-slate-50 dark:hover:bg-slate-700 transition">Batal</button>
                            )}
                            <button onClick={onConfirm} className={`flex-1 py-2.5 rounded-xl text-white font-semibold shadow-lg transition ${isDanger ? 'bg-red-600 hover:bg-red-700 shadow-red-500/30' : 'bg-blue-600 hover:bg-blue-700 shadow-blue-500/30'}`}>
                                {isAlert ? 'OK' : (isDanger ? 'Ya, Hapus' : 'Ya, Lanjutkan')}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        );

        const UploadModal = ({ types, units, onClose, onSave, openAlert }) => {
            const [activeTab, setActiveTab] = useState('file'); 
            const [formData, setFormData] = useState({ name: '', typeName: '', unitName: '', status: 'Private', filename: '', fileObj: null });
            const handleSubmit = (e) => { e.preventDefault(); if (!formData.name || !formData.typeName || !formData.unitName || !formData.filename) { openAlert('Data Belum Lengkap', 'Mohon lengkapi semua field yang wajib diisi.'); return; } onSave({...formData, fileType: activeTab}); };
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in"><div className="bg-white dark:bg-slate-800 w-full max-w-lg rounded-2xl p-6 shadow-2xl animate-slide-up border border-slate-200 dark:border-slate-700"><div className="flex justify-between items-center mb-6"><h3 className="text-xl font-bold text-slate-800 dark:text-white">Upload Arsip Baru</h3><button onClick={onClose} className="text-slate-400 hover:text-red-500"><Icons.X width={24} /></button></div><div className="flex space-x-2 mb-6 bg-slate-100 dark:bg-slate-900 p-1 rounded-xl"><button onClick={() => setActiveTab('file')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition ${activeTab === 'file' ? 'bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-white' : 'text-slate-500 dark:text-slate-400'}`}>Upload File</button><button onClick={() => setActiveTab('link')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition ${activeTab === 'link' ? 'bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-white' : 'text-slate-500 dark:text-slate-400'}`}>Link Dokumen</button></div><form onSubmit={handleSubmit} className="space-y-4"><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Nama Dokumen</label><input required type="text" className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none focus:ring-2 focus:ring-blue-500" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} /></div><div className="grid grid-cols-2 gap-4"><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Jenis</label><select required className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none" value={formData.typeName} onChange={e => setFormData({...formData, typeName: e.target.value})}><option value="">Pilih Jenis</option>{types.map(t => <option key={t.id} value={t.name}>{t.name}</option>)}</select></div><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Unit</label><select required className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none" value={formData.unitName} onChange={e => setFormData({...formData, unitName: e.target.value})}><option value="">Pilih Unit</option>{units.map(u => <option key={u.id} value={u.name}>{u.name}</option>)}</select></div></div><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Status</label><select className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none" value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})}><option value="Private">Private (Internal)</option><option value="Public">Public (Umum)</option></select></div><div className="pt-2"><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">{activeTab === 'file' ? 'Pilih File' : 'URL Link Dokumen'}</label>{activeTab === 'file' ? (<div className="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6 text-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition relative"><Icons.Upload className="mx-auto text-slate-400 mb-2" /><p className="text-sm text-slate-500">Klik untuk pilih file</p><input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e => {const f=e.target.files[0]; if(f) setFormData({...formData, filename: f.name, fileObj: f})}} />{formData.filename && <p className="text-sm text-blue-600 mt-2 font-bold">{formData.filename}</p>}</div>) : (<input type="url" placeholder="https://..." className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none focus:ring-2 focus:ring-blue-500" value={formData.filename} onChange={e => setFormData({...formData, filename: e.target.value})} />)}</div><button className="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl mt-4">Simpan Arsip</button></form></div></div>
            );
        };

        const MasterDataModal = ({ type, initialData, onClose, onSave }) => {
            const [formData, setFormData] = useState(initialData || (type === 'users' ? { username: '', password: '', role: 'Operator' } : { name: '' }));
            const title = type === 'types' ? 'Jenis Arsip' : type === 'units' ? 'Unit Kerja' : 'User';
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in"><div className="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl p-6 shadow-2xl animate-slide-up border border-slate-200 dark:border-slate-700"><div className="flex justify-between items-center mb-6"><h3 className="text-xl font-bold text-slate-800 dark:text-white">{initialData ? 'Edit' : 'Tambah'} {title}</h3><button onClick={onClose} className="text-slate-400 hover:text-red-500"><Icons.X width={24} /></button></div><form onSubmit={(e)=>{e.preventDefault(); onSave(formData);}} className="space-y-4">{type === 'users' ? (<><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Username</label><input required className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none" value={formData.username} onChange={e => setFormData({...formData, username: e.target.value})} /></div><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Password</label><input required className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none" value={formData.password} onChange={e => setFormData({...formData, password: e.target.value})} /></div><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Role</label><select className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none" value={formData.role} onChange={e => setFormData({...formData, role: e.target.value})}><option>Admin</option><option>Operator</option><option>Viewer</option></select></div></>) : (<div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Nama {title}</label><input required className="w-full px-4 py-2 rounded-lg border dark:border-slate-600 bg-transparent dark:text-white outline-none" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} /></div>)}<button className="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl mt-2">Simpan Data</button></form></div></div>
            );
        };

        const PreviewModal = ({ item, onClose }) => {
            // Fix Preview URL for Google Drive
            let src = item.fileUrl || `dokumen/${item.filename}`;
            if (src.includes('drive.google.com') && src.includes('/view')) {
                src = src.replace('/view', '/preview');
            }
            // Check for image extension
            const isImage = item.filename.match(/\.(jpeg|jpg|gif|png)$/i);

            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in"><div className="bg-white dark:bg-slate-900 w-full max-w-5xl h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-slide-up relative"><button onClick={onClose} className="absolute top-4 right-4 z-50 p-2 bg-black/50 hover:bg-red-600 text-white rounded-full transition backdrop-blur-md"><Icons.X width={24} /></button><div className="px-6 py-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-white dark:bg-slate-900 z-40"><div><h3 className="font-bold text-lg text-slate-800 dark:text-white truncate max-w-md">{item.name}</h3><p className="text-xs text-slate-500">{item.fileType === 'link' ? 'Link Eksternal' : item.filename}</p></div></div><div className="flex-1 bg-slate-100 dark:bg-slate-950 flex flex-col items-center justify-center relative overflow-hidden">{item.fileType === 'link' ? (<div className="text-center p-8"><div className="w-24 h-24 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-6 text-blue-600 animate-pulse"><Icons.LinkIcon width={48} /></div><h4 className="text-2xl font-bold mb-3 dark:text-white">Tautan Eksternal</h4><p className="text-slate-500 mb-8 max-w-md mx-auto break-words bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700 font-mono text-sm">{item.filename}</p><a href={item.filename} target="_blank" className="px-8 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 inline-flex items-center shadow-lg shadow-blue-500/30 transition transform hover:-translate-y-1">Buka Tautan <Icons.Globe width={18} className="ml-2"/></a></div>) : (isImage ? <img src={src} className="max-w-full max-h-full object-contain" /> : (item.filename.toLowerCase().endsWith('.pdf') || src.includes('drive.google.com') ? (<iframe src={src} className="w-full h-full border-none" title="Preview"></iframe>) : (<div className="text-center p-8"><div className="w-24 h-24 bg-slate-200 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-500"><Icons.FileText width={48} /></div><h4 className="text-xl font-bold mb-2 dark:text-white">Pratinjau File</h4><p className="text-slate-500 mb-6">Tipe file ini tidak mendukung pratinjau langsung.</p><a href={src} download={item.filename} className="px-6 py-2 border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-300 rounded-lg font-semibold hover:bg-slate-50 dark:hover:bg-slate-800 transition">Unduh untuk Melihat</a></div>)))}</div></div></div>
            );
        };

        const StatCard = ({ title, value, icon: IconName, color }) => {
            const Icon = Icons[IconName];
            const colors = { 
                blue: "text-blue-600 bg-blue-100 dark:bg-blue-900/30", 
                green: "text-green-600 bg-green-100 dark:bg-green-900/30", 
                purple: "text-purple-600 bg-purple-100 dark:bg-purple-900/30", 
                orange: "text-orange-600 bg-orange-100 dark:bg-orange-900/30" 
            };
            return (
                <div className="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 flex items-start justify-between hover:shadow-md transition duration-300">
                    <div>
                        <p className="text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">{title}</p>
                        <h3 className="text-3xl font-bold text-slate-800 dark:text-white">{value}</h3>
                    </div>
                    <div className={`p-3 rounded-xl ${colors[color]}`}>
                        <Icon width={24} height={24} />
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---

        function App() {
            // UI State
            const [activeMenu, setActiveMenu] = useState('public');
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [isProcessing, setIsProcessing] = useState(false);
            
            // Modal States
            const [showUploadModal, setShowUploadModal] = useState(false);
            const [showMasterModal, setShowMasterModal] = useState(false); 
            const [showPreviewModal, setShowPreviewModal] = useState(false);
            
            const [confirmConfig, setConfirmConfig] = useState({ isOpen: false, title: '', message: '', onConfirm: () => {}, isDanger: false, isAlert: false });
            
            const [previewItem, setPreviewItem] = useState(null);
            const [masterItem, setMasterItem] = useState(null); 
            const [masterType, setMasterType] = useState(''); 

            const [viewMode, setViewMode] = useState('card');
            const [searchTerm, setSearchTerm] = useState('');
            const [filterType, setFilterType] = useState('Semua');
            const [filterStatus, setFilterStatus] = useState('Semua');
            const [filterUnit, setFilterUnit] = useState('Semua');

            // Data States
            const [archives, setArchives] = useState([]);
            const [types, setTypes] = useState([]);
            const [units, setUnits] = useState([]);
            const [appUsers, setAppUsers] = useState([]);

            // ... (Rest of logic: useEffects, Handlers, etc.) ...
            
            // --- LOAD DATA (Google + Local) ---
            useEffect(() => {
                const loadData = async () => {
                    try {
                        try {
                            const res = await fetch(WEB_APP_URL, { redirect: 'follow' });
                            if(res.ok) {
                                const cloudData = await res.json();
                                if(Array.isArray(cloudData)) setArchives(cloudData);
                            }
                        } catch(e) { console.log('Google Fetch Error:', e); }

                        const localTypes = localStorage.getItem('types');
                        if (localTypes) setTypes(JSON.parse(localTypes));
                        else fetch('./data/jenis.json').then(r=>r.ok&&r.json()).then(setTypes).catch(()=>{});

                        const localUnits = localStorage.getItem('units');
                        if (localUnits) setUnits(JSON.parse(localUnits));
                        else fetch('./data/unit.json').then(r=>r.ok&&r.json()).then(setUnits).catch(()=>{});

                        const localUsers = localStorage.getItem('appUsers');
                        if (localUsers) setAppUsers(JSON.parse(localUsers));
                        else setAppUsers([{ id: 1, username: "admin_sistem", password: "123", role: "Operator" }, { id: 2, username: "pengamat", password: "123", role: "Viewer" }]);

                        setIsLoading(false);
                    } catch (error) {
                        console.error("Error loading data:", error);
                        setIsLoading(false);
                    }
                };
                loadData();
            }, []);

            useEffect(() => { if(!isLoading) localStorage.setItem('types', JSON.stringify(types)); }, [types, isLoading]);
            useEffect(() => { if(!isLoading) localStorage.setItem('units', JSON.stringify(units)); }, [units, isLoading]);
            useEffect(() => { if(!isLoading) localStorage.setItem('appUsers', JSON.stringify(appUsers)); }, [appUsers, isLoading]);

            useEffect(() => { if (isDarkMode) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); }, [isDarkMode]);
            useEffect(() => { setSearchTerm(''); setFilterType('Semua'); setFilterStatus('Semua'); setFilterUnit('Semua'); }, [activeMenu]);

            const openConfirm = ({ title, message, onConfirm, isDanger = false }) => { setConfirmConfig({ isOpen: true, title, message, onConfirm: () => { onConfirm(); setConfirmConfig(prev => ({ ...prev, isOpen: false })); }, isDanger, isAlert: false }); };
            const openAlert = (title, message) => { setConfirmConfig({ isOpen: true, title, message, onConfirm: () => setConfirmConfig(prev => ({ ...prev, isOpen: false })), isDanger: false, isAlert: true }); };

            const handleLogin = (u, p) => {
                if (u === 'mahaadmin' && p === 'mahaadmin') { setIsLoggedIn(true); setActiveMenu('dashboard'); }
                else { const foundUser = appUsers.find(user => user.username === u && user.password === p); if (foundUser) { setIsLoggedIn(true); setActiveMenu('dashboard'); } else { openAlert('Login Gagal', 'Username atau Password salah. Silakan coba lagi.'); } }
            };

            const handleUpload = async (data) => {
                setIsProcessing(true); setShowUploadModal(false);
                let payload = { action: "create", ...data };
                if (data.fileType === 'file' && data.fileObj) {
                    const reader = new FileReader(); reader.readAsDataURL(data.fileObj);
                    reader.onload = async () => {
                        payload.fileData = reader.result; payload.fileName = data.filename; delete payload.fileObj;
                        try { await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload), redirect: 'follow' }); const res = await fetch(WEB_APP_URL, { redirect: 'follow' }); if(res.ok) setArchives(await res.json()); openAlert('Berhasil', 'Arsip berhasil diunggah!'); } catch(e) { openAlert('Gagal', 'Gagal upload: ' + e.message + '. Pastikan Google Script di-deploy "Anyone"'); } setIsProcessing(false);
                    }; reader.onerror = () => { setIsProcessing(false); openAlert('Error', 'Error membaca file'); };
                } else {
                    try { await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload), redirect: 'follow' }); const res = await fetch(WEB_APP_URL, { redirect: 'follow' }); if(res.ok) setArchives(await res.json()); openAlert('Berhasil', 'Arsip berhasil disimpan!'); } catch(e) { openAlert('Gagal', 'Gagal simpan: ' + e.message); } setIsProcessing(false);
                }
            };

            const handleDeleteArchive = (id) => { openConfirm({ title: "Hapus Arsip", message: "Yakin ingin menghapus arsip ini secara permanen?", onConfirm: async () => { setIsProcessing(true); try { await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: "delete", id: id }), redirect: 'follow' }); setArchives(archives.filter(a => a.id !== id)); openAlert('Dihapus', 'Arsip berhasil dihapus.'); } catch(e) { openAlert('Gagal', 'Gagal hapus: ' + e.message); } setIsProcessing(false); }, isDanger: true }); };
            const handleDownload = (item) => { openConfirm({ title: "Unduh Dokumen", message: `Apakah Anda ingin mengunduh berkas "${item.name}"?`, onConfirm: () => { window.open(item.fileUrl || item.filename, '_blank'); } }); };
            const openMasterModal = (type, item = null) => { setMasterType(type); setMasterItem(item); setShowMasterModal(true); };
            const handleSaveMaster = (data) => { const isEdit = !!data.id; const newItem = isEdit ? data : { ...data, id: Date.now() }; if (masterType === 'types') isEdit ? setTypes(types.map(t => t.id === newItem.id ? newItem : t)) : setTypes([...types, newItem]); else if (masterType === 'units') isEdit ? setUnits(units.map(u => u.id === newItem.id ? newItem : u)) : setUnits([...units, newItem]); else if (masterType === 'users') isEdit ? setAppUsers(appUsers.map(u => u.id === newItem.id ? newItem : u)) : setAppUsers([...appUsers, newItem]); setShowMasterModal(false); };
            const handleDeleteMaster = (type, id) => { openConfirm({ title: "Hapus Data", message: "Hapus data ini dari browser?", onConfirm: () => { if (type === 'types') setTypes(types.filter(t => t.id !== id)); else if (type === 'units') setUnits(units.filter(u => u.id !== id)); else if (type === 'users') setAppUsers(appUsers.filter(u => u.id !== id)); }, isDanger: true }); };
            const handlePreview = (item) => { setPreviewItem(item); setShowPreviewModal(true); };

            const filteredArchives = useMemo(() => { return archives.filter(item => { if (activeMenu === 'public' && item.status !== 'Public') return false; const matchesSearch = item.name.toLowerCase().includes(searchTerm.toLowerCase()); const matchesType = filterType === 'Semua' || item.typeName === filterType; const matchesStatus = filterStatus === 'Semua' || item.status === filterStatus; const matchesUnit = filterUnit === 'Semua' || item.unitName === filterUnit; return matchesSearch && matchesType && matchesStatus && matchesUnit; }); }, [archives, activeMenu, searchTerm, filterType, filterStatus, filterUnit]);
            const stats = useMemo(() => ({ totalArsip: archives.length, totalJenis: types.length, totalUnit: units.length, recent: archives.slice(0, 5), publicCount: archives.filter(a => a.status === 'Public').length }), [archives, types, units]);

            return (
                <div className={`flex h-screen overflow-hidden ${isDarkMode ? 'dark bg-slate-900' : 'bg-slate-50'}`}>
                    {(isLoading || isProcessing) && <div className="loading-overlay"><div className="flex flex-col items-center"><div className="spinner mb-4"></div><p className="text-white font-bold">{isLoading ? 'Memuat Data...' : 'Sedang Memproses...'}</p></div></div>}
                    {confirmConfig.isOpen && <ConfirmModal {...confirmConfig} onCancel={() => setConfirmConfig(p => ({...p, isOpen: false}))} />}
                    {showUploadModal && <UploadModal types={types} units={units} onClose={() => setShowUploadModal(false)} onSave={handleUpload} openAlert={openAlert} />}
                    {showMasterModal && <MasterDataModal type={masterType} initialData={masterItem} onClose={() => setShowMasterModal(false)} onSave={handleSaveMaster} />}
                    {showPreviewModal && previewItem && <PreviewModal item={previewItem} onClose={() => { setShowPreviewModal(false); setPreviewItem(null); }} />}

                    <aside className={`hidden md:flex ${isSidebarOpen ? 'w-64' : 'w-20'} bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex-col transition-all duration-300 z-20 shadow-xl`}>
                        <div className="p-6 flex items-center justify-between"><div className="flex items-center space-x-3 overflow-hidden"><div className="bg-blue-600 p-2 rounded-lg text-white shrink-0"><Icons.FolderOpen width={24} /></div>{isSidebarOpen && <div className="whitespace-nowrap animate-fade-in"><h1 className="font-bold text-slate-800 dark:text-white leading-tight">E-Arsip</h1><p className="text-xs text-slate-500">Biro Kepesantrenan</p></div>}</div></div>
                        <div className="px-4 mb-2"><button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="w-full py-2 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg text-slate-500 flex items-center justify-center transition">{isSidebarOpen ? <Icons.ChevronLeft width={16}/> : <Icons.ChevronRight width={16}/>}</button></div>
                        <nav className="flex-1 px-4 space-y-1 overflow-y-auto py-2">
                            {isLoggedIn ? (
                                <>{isSidebarOpen && <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 mt-2 pl-4">Menu Utama</div>}<SidebarItem id="dashboard" icon="LayoutDashboard" label="Dashboard" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /><SidebarItem id="archives" icon="FileText" label="Data Arsip" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /><SidebarItem id="types" icon="FileCheck" label="Jenis Arsip" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /><SidebarItem id="units" icon="Building2" label="Data Unit" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /><div className="my-4 border-t border-slate-100 dark:border-slate-800"></div>{isSidebarOpen && <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 pl-4">Akses Publik</div>}<SidebarItem id="public" icon="Search" label="Arsip Publik" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /><div className="my-4 border-t border-slate-100 dark:border-slate-800"></div>{isSidebarOpen && <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 pl-4">Sistem</div>}<SidebarItem id="users" icon="Users" label="Manajemen User" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /><SidebarItem id="settings" icon="Settings" label="Pengaturan" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /></>
                            ) : (<><SidebarItem id="public" icon="Search" label="Arsip Publik" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /><SidebarItem id="login" icon="ShieldCheck" label="Login Admin" activeMenu={activeMenu} setActiveMenu={setActiveMenu} isSidebarOpen={isSidebarOpen} /></>)}
                        </nav>
                        <div className="p-4 border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50"><button onClick={() => setIsDarkMode(!isDarkMode)} className="flex items-center justify-center w-full p-2 mb-3 rounded-lg bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-600 transition border border-slate-200 dark:border-slate-600">{isDarkMode ? <Icons.Sun width={16} /> : <Icons.Moon width={16} />}{isSidebarOpen && <span className="ml-2 text-xs font-semibold">Mode {isDarkMode ? 'Terang' : 'Gelap'}</span>}</button>{isLoggedIn && isSidebarOpen && (<div className="flex items-center space-x-3 animate-fade-in"><div className="w-9 h-9 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 text-white flex items-center justify-center font-bold shadow-lg">A</div><div className="flex-1 overflow-hidden"><p className="text-sm font-bold text-slate-700 dark:text-slate-200">Administrator</p><p className="text-xs text-green-500 flex items-center">‚óè Online</p></div><button onClick={() => { setIsLoggedIn(false); setActiveMenu('public'); }} className="text-slate-400 hover:text-red-500 transition"><Icons.LogOut width={18} /></button></div>)}</div>
                    </aside>

                    <main className="flex-1 flex flex-col h-screen overflow-hidden relative bg-slate-50 dark:bg-slate-900 pb-20 md:pb-0">
                         <header className="h-16 bg-white/80 dark:bg-slate-900/80 backdrop-blur border-b border-slate-200 dark:border-slate-800 flex items-center justify-between px-6 sticky top-0 z-10"><div className="flex items-center"><h2 className="text-lg font-bold text-slate-800 dark:text-white capitalize flex items-center"><span className="text-slate-400 mr-2 font-light">/</span> {activeMenu.replace('_', ' ')}</h2></div><div className="flex items-center space-x-4"><div className="text-xs text-slate-500 hidden md:block">{new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div><button onClick={() => setIsDarkMode(!isDarkMode)} className="md:hidden p-2 text-slate-500 dark:text-slate-400">{isDarkMode ? <Icons.Sun width={20} /> : <Icons.Moon width={20} />}</button></div></header>
                        <div className="flex-1 overflow-y-auto p-6 md:p-8">
                            {/* ... Content Logic ... (Kept inside App return above) */}
                            {activeMenu === 'login' && !isLoggedIn && (
                                <div className="flex flex-col items-center justify-center h-full max-w-md mx-auto -mt-16"><div className="text-center mb-8"><div className="inline-block p-4 bg-blue-100 dark:bg-blue-900/30 rounded-2xl text-blue-600 mb-4"><Icons.ShieldCheck width={48} height={48} /></div><h2 className="text-3xl font-bold text-slate-800 dark:text-white">Admin Login</h2><p className="text-slate-500 mt-2">Masuk untuk mengelola arsip pesantren</p></div><div className="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-xl w-full border border-slate-200 dark:border-slate-700"><form onSubmit={(e) => {e.preventDefault(); handleLogin(e.target.u.value, e.target.p.value)}}><div className="space-y-5"><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Username</label><input name="u" className="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="admin" /></div><div><label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Password</label><input name="p" type="password" className="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="admin" /></div><button className="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-500/30 transition transform hover:-translate-y-1">Masuk Dashboard</button></div></form></div></div>
                            )}
                            {activeMenu === 'dashboard' && isLoggedIn && (
                                <div className="space-y-8 animate-fade-in-up"><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"><StatCard title="Total Arsip" value={stats.totalArsip} icon="FileText" color="blue" /><StatCard title="Arsip Publik" value={stats.publicCount} icon="Users" color="green" /><StatCard title="Jenis Dokumen" value={stats.totalJenis} icon="FileCheck" color="purple" /><StatCard title="Unit Kerja" value={stats.totalUnit} icon="Building2" color="orange" /></div><div className="grid grid-cols-1 lg:grid-cols-3 gap-8"><div className="lg:col-span-2 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden"><div className="px-6 py-5 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center"><h3 className="font-bold text-slate-800 dark:text-white text-lg">Arsip Terbaru</h3><button onClick={() => setActiveMenu('archives')} className="text-sm text-blue-600 font-medium hover:underline flex items-center">Lihat Semua <Icons.ChevronRight width={16} /></button></div><div className="overflow-x-auto"><table className="w-full text-sm text-left"><thead className="bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 uppercase text-xs tracking-wider"><tr><th className="px-6 py-4">Nama Dokumen</th><th className="px-6 py-4">Unit</th><th className="px-6 py-4">Status</th></tr></thead><tbody className="divide-y divide-slate-100 dark:divide-slate-700">{stats.recent.map((item) => (<tr key={item.id} className="hover:bg-slate-50 dark:hover:bg-slate-700/30 transition"><td className="px-6 py-4"><div className="font-medium text-slate-800 dark:text-slate-200 flex items-center gap-2">{item.fileType === 'link' ? <Icons.LinkIcon width={14} className="text-blue-500" /> : <Icons.FileText width={14} className="text-slate-400" />}{item.name}</div><div className="text-xs text-slate-500">{item.date}</div></td><td className="px-6 py-4 text-slate-600 dark:text-slate-400">{item.unitName}</td><td className="px-6 py-4"><span className={`px-2.5 py-1 text-xs font-semibold rounded-full border ${item.status === 'Public' ? 'bg-green-50 text-green-600 border-green-200 dark:bg-green-900/20 dark:border-green-800' : 'bg-slate-50 text-slate-600 border-slate-200 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-400'}`}>{item.status}</span></td></tr>))}</tbody></table></div></div><div className="space-y-6"><div className="bg-gradient-to-br from-blue-600 to-indigo-700 rounded-2xl p-6 text-white shadow-lg"><h3 className="text-lg font-bold mb-2">Upload Arsip Baru</h3><p className="text-blue-100 text-sm mb-4">Simpan dokumen penting Biro Kepesantrenan dengan aman dan terstruktur.</p><button onClick={() => { setActiveMenu('archives'); setShowUploadModal(true); }} className="w-full py-2 bg-white text-blue-600 rounded-lg font-bold text-sm hover:bg-blue-50 transition shadow-sm">Ke Menu Upload</button></div></div></div></div>
                            )}
                            {(activeMenu === 'archives' || activeMenu === 'public') && (
                                <div className="space-y-6 animate-fade-in"><div className="flex flex-col md:flex-row md:items-center justify-between gap-4"><div><h2 className="text-2xl font-bold text-slate-800 dark:text-white">{activeMenu === 'public' ? 'Arsip Publik' : 'Manajemen Arsip'}</h2><p className="text-slate-500 text-sm">{activeMenu === 'public' ? 'Dokumen yang dapat diakses oleh umum' : 'Kelola seluruh dokumen internal dan eksternal'}</p></div>{activeMenu === 'archives' && <button onClick={() => setShowUploadModal(true)} className="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl font-medium shadow-lg shadow-blue-500/30 flex items-center transition transform hover:-translate-y-0.5"><Icons.Upload width={18} className="mr-2"/> Upload Baru</button>}</div><div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 flex flex-col md:flex-row gap-4"><div className="flex-1 relative"><Icons.Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" width={18} /><input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="Cari dokumen..." className="w-full pl-10 pr-4 py-2 rounded-lg bg-slate-50 dark:bg-slate-900 border-none outline-none text-slate-700 dark:text-white" /></div><div className="flex gap-2 overflow-x-auto pb-2 md:pb-0"><select value={filterUnit} onChange={(e) => setFilterUnit(e.target.value)} className="bg-slate-50 dark:bg-slate-900 border-none rounded-lg px-4 py-2 text-slate-600 dark:text-slate-300 outline-none cursor-pointer min-w-[140px]"><option value="Semua">Semua Unit</option>{units.map(u => <option key={u.id} value={u.name}>{u.name}</option>)}</select><select value={filterType} onChange={(e) => setFilterType(e.target.value)} className="bg-slate-50 dark:bg-slate-900 border-none rounded-lg px-4 py-2 text-slate-600 dark:text-slate-300 outline-none cursor-pointer min-w-[140px]"><option value="Semua">Semua Jenis</option>{types.map(t => <option key={t.id} value={t.name}>{t.name}</option>)}</select><select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)} className="bg-slate-50 dark:bg-slate-900 border-none rounded-lg px-4 py-2 text-slate-600 dark:text-slate-300 outline-none cursor-pointer min-w-[140px]"><option value="Semua">Semua Status</option><option value="Public">Public</option><option value="Private">Private</option></select></div><div className="flex bg-slate-50 dark:bg-slate-900 rounded-lg p-1 border border-slate-100 dark:border-slate-700"><button onClick={() => setViewMode('card')} className={`p-2 rounded-md transition ${viewMode === 'card' ? 'bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-blue-400' : 'text-slate-400 hover:text-slate-600'}`}><Icons.Grid width={18} /></button><button onClick={() => setViewMode('list')} className={`p-2 rounded-md transition ${viewMode === 'list' ? 'bg-white dark:bg-slate-700 shadow text-blue-600 dark:text-blue-400' : 'text-slate-400 hover:text-slate-600'}`}><Icons.List width={18} /></button></div></div>{viewMode === 'card' ? (<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in">{filteredArchives.length > 0 ? filteredArchives.map(item => (<div key={item.id} className="group bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 hover:shadow-xl hover:border-blue-300 dark:hover:border-blue-700 transition duration-300 flex flex-col"><div className="flex items-start justify-between mb-4"><div className={`p-3 rounded-xl group-hover:scale-110 transition ${item.fileType === 'link' ? 'bg-purple-50 dark:bg-purple-900/20 text-purple-600' : 'bg-blue-50 dark:bg-blue-900/20 text-blue-600'}`}>{item.fileType === 'link' ? <Icons.LinkIcon width={24} /> : <Icons.FileText width={24} />}</div><span className="text-xs font-mono text-slate-400 bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded">{item.date}</span></div><h3 className="font-bold text-slate-800 dark:text-white text-lg mb-2 line-clamp-2 leading-snug">{item.name}</h3><div className="flex flex-wrap gap-2 mb-6"><span className="text-[10px] font-bold uppercase tracking-wide bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-slate-500 dark:text-slate-400">{item.typeName}</span><span className="text-[10px] font-bold uppercase tracking-wide bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1 rounded text-indigo-500 dark:text-indigo-400">{item.unitName}</span><span className={`text-[10px] font-bold uppercase tracking-wide px-2 py-1 rounded border ${item.status === 'Public' ? 'bg-green-50 text-green-600 border-green-200 dark:bg-green-900/20 dark:border-green-800' : 'bg-slate-50 text-slate-500 border-slate-200 dark:bg-slate-800 dark:border-slate-600'}`}>{item.status}</span></div><div className="mt-auto pt-4 border-t border-slate-100 dark:border-slate-700 flex gap-2"><button onClick={() => handlePreview(item)} className="flex-1 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-lg text-sm font-semibold hover:bg-blue-100 dark:hover:bg-blue-900/40 transition flex items-center justify-center"><Icons.Eye width={16} className="mr-2" /> Lihat</button><button onClick={() => handleDownload(item)} className="flex-1 py-2 bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-lg text-sm font-semibold hover:bg-slate-100 dark:hover:bg-slate-600 transition flex items-center justify-center"><Icons.Download width={16} className="mr-2" /> Unduh</button>{activeMenu === 'archives' && <button onClick={() => handleDeleteArchive(item.id)} className="px-3 py-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition"><Icons.Trash2 width={18} /></button>}</div></div>)) : <div className="col-span-full py-10 text-center text-slate-400">Tidak ada dokumen yang sesuai filter.</div>}</div>) : (<div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden animate-fade-in"><div className="overflow-x-auto"><table className="w-full text-sm text-left"><thead className="bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 uppercase text-xs tracking-wider"><tr><th className="px-6 py-4">Nama Dokumen</th><th className="px-6 py-4">Jenis</th><th className="px-6 py-4">Unit</th><th className="px-6 py-4">Status</th><th className="px-6 py-4">Tanggal</th><th className="px-6 py-4 text-right">Aksi</th></tr></thead><tbody className="divide-y divide-slate-100 dark:divide-slate-700">{filteredArchives.length > 0 ? filteredArchives.map((item) => (<tr key={item.id} className="hover:bg-slate-50 dark:hover:bg-slate-700/30 transition"><td className="px-6 py-4"><div className="font-medium text-slate-800 dark:text-slate-200 flex items-center gap-2">{item.fileType === 'link' ? <Icons.LinkIcon width={16} className="text-purple-500" /> : <Icons.FileText width={16} className="text-blue-500" />}{item.name}</div></td><td className="px-6 py-4 text-slate-600 dark:text-slate-400">{item.typeName}</td><td className="px-6 py-4 text-slate-600 dark:text-slate-400">{item.unitName}</td><td className="px-6 py-4"><span className={`px-2.5 py-1 text-xs font-semibold rounded-full border ${item.status === 'Public' ? 'bg-green-50 text-green-600 border-green-200 dark:bg-green-900/20 dark:border-green-800' : 'bg-slate-50 text-slate-600 border-slate-200 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-400'}`}>{item.status}</span></td><td className="px-6 py-4 text-slate-500">{item.date}</td><td className="px-6 py-4 text-right"><div className="flex items-center justify-end gap-2"><button onClick={() => handlePreview(item)} className="p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition" title="Lihat"><Icons.Eye width={16} /></button><button onClick={() => handleDownload(item)} className="p-2 text-slate-600 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-700 rounded-lg transition" title="Unduh"><Icons.Download width={16} /></button>{activeMenu === 'archives' && <button onClick={() => handleDeleteArchive(item.id)} className="p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition" title="Hapus"><Icons.Trash2 width={16} /></button>}</div></td></tr>)) : <tr><td colSpan="6" className="text-center py-10 text-slate-400">Tidak ada dokumen.</td></tr>}</tbody></table></div></div>)}</div>
                            )}
                            
                            {(activeMenu === 'types' || activeMenu === 'units' || activeMenu === 'users') && (
                                <div className="max-w-4xl mx-auto space-y-6 animate-fade-in"><div className="flex justify-between items-center"><h2 className="text-2xl font-bold text-slate-800 dark:text-white">{activeMenu === 'types' ? 'Jenis Arsip' : activeMenu === 'units' ? 'Data Unit Kerja' : 'Manajemen User'}</h2><button onClick={() => openMasterModal(activeMenu)} className="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700 flex items-center shadow-lg shadow-blue-500/30">+ Tambah Data</button></div><div className="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 p-3 rounded-lg text-sm text-yellow-800 dark:text-yellow-200 mb-4"><strong>Catatan Admin:</strong> Perubahan yang Anda lakukan di sini akan disimpan di <em>Browser</em> ini. Untuk perubahan permanen ke publik, harap edit file JSON di GitHub.</div><div className="bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden shadow-sm"><table className="w-full text-sm text-left"><thead className="bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400"><tr><th className="px-6 py-4">ID</th><th className="px-6 py-4">{activeMenu === 'users' ? 'Username' : 'Nama'}</th>{activeMenu === 'users' && <th className="px-6 py-4">Role</th>}<th className="px-6 py-4 text-right">Aksi</th></tr></thead><tbody className="divide-y divide-slate-100 dark:divide-slate-700">{(activeMenu === 'types' ? types : activeMenu === 'units' ? units : appUsers).map((item) => (<tr key={item.id} className="hover:bg-slate-50 dark:hover:bg-slate-700/30"><td className="px-6 py-4 text-slate-400 w-16">#{item.id}</td><td className="px-6 py-4 font-medium text-slate-800 dark:text-slate-200">{activeMenu === 'users' ? item.username : item.name}</td>{activeMenu === 'users' && <td className="px-6 py-4"><span className="px-2 py-1 rounded bg-slate-100 dark:bg-slate-700 text-xs text-slate-600 dark:text-slate-300">{item.role}</span></td>}<td className="px-6 py-4 text-right"><button onClick={() => openMasterModal(activeMenu, item)} className="text-slate-400 hover:text-blue-600 mr-3"><Icons.Edit width={16} /></button><button onClick={() => handleDeleteMaster(activeMenu, item.id)} className="text-slate-400 hover:text-red-600"><Icons.Trash2 width={16} /></button></td></tr>))}</tbody></table></div></div>
                            )}

                            {activeMenu === 'settings' && (
                                <div className="max-w-2xl mx-auto space-y-6 animate-fade-in"><h2 className="text-2xl font-bold text-slate-800 dark:text-white">Pengaturan Akun</h2><div className="bg-white dark:bg-slate-800 p-8 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm"><div className="flex items-center space-x-4 mb-8"><div className="w-16 h-16 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl font-bold">A</div><div><h3 className="font-bold text-lg dark:text-white">Administrator</h3><p className="text-slate-500">Super Admin Access</p></div></div><form className="space-y-4" onSubmit={(e)=>e.preventDefault()}><div><label className="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Ganti Password</label><input type="password" placeholder="Password Lama" className="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-transparent dark:text-white mb-2" /><input type="password" placeholder="Password Baru" className="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-transparent dark:text-white" /></div><div className="pt-4"><button className="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 transition">Simpan Perubahan</button></div></form></div></div>
                            )}
                        </div>
                    </main>

                    <div className="fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 flex md:hidden justify-around items-center px-2 z-50 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
                        {isLoggedIn ? (
                            <><BottomNavItem id="dashboard" icon="LayoutDashboard" label="Dash" activeMenu={activeMenu} setActiveMenu={setActiveMenu} /><BottomNavItem id="archives" icon="FileText" label="Arsip" activeMenu={activeMenu} setActiveMenu={setActiveMenu} /><BottomNavItem id="public" icon="Search" label="Publik" activeMenu={activeMenu} setActiveMenu={setActiveMenu} /><BottomNavItem id="users" icon="Users" label="User" activeMenu={activeMenu} setActiveMenu={setActiveMenu} /></>
                        ) : (
                            <><BottomNavItem id="public" icon="Search" label="Arsip Publik" activeMenu={activeMenu} setActiveMenu={setActiveMenu} /><BottomNavItem id="login" icon="ShieldCheck" label="Login Admin" activeMenu={activeMenu} setActiveMenu={setActiveMenu} /></>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>